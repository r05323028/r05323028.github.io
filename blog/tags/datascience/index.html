<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.2">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Sean Chang Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Sean Chang Blog Atom Feed"><title data-react-helmet="true">One post tagged with &quot;datascience&quot; | Sean Chang</title><meta data-react-helmet="true" property="og:title" content="One post tagged with &quot;datascience&quot; | Sean Chang"><meta data-react-helmet="true" property="og:url" content="https://r05323028.github.io/blog/tags/datascience"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="canonical" href="https://r05323028.github.io/blog/tags/datascience"><link data-react-helmet="true" rel="alternate" href="https://r05323028.github.io/blog/tags/datascience" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://r05323028.github.io/blog/tags/datascience" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.7623652c.css">
<link rel="preload" href="/assets/js/runtime~main.0a5721f4.js" as="script">
<link rel="preload" href="/assets/js/main.a028968b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">Sean Chang</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">部落格</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/r05323028" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><b class="navbar__title">Sean Chang</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">部落格</a></li><li class="menu__list-item"><a href="https://github.com/r05323028" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/eyes">Eyes - 台灣輿情監測系統</a></li></ul></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>One post tagged with &quot;datascience&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl"><header><h2 class="blogPostTitle_GeHD"><a href="/blog/eyes">Eyes - 台灣輿情監測系統</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-10-15T00:00:00.000Z">October 15, 2021</time> · 5 min read</div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/37167503?s=60&amp;v=4" alt="Sean Chang"></a><div class="avatar__intro"><div class="avatar__name"><a>Sean Chang</a></div><small class="avatar__subtitle">Senior Data Scientist @ KKLab, KKBOX Group</small></div></div></header><div class="markdown"><p><img src="https://raw.githubusercontent.com/r05323028/eyes/main/doc/static/images/brand_dark.jpg" alt="Brand"></p><p>Source Code: <a href="https://github.com/r05323028/eyes" target="_blank" rel="noopener noreferrer">https://github.com/r05323028/eyes</a></p><p>近期心血來潮想說把在公司第一年建制的輿情監測系統重新構思，然後重寫成一個新的開源專案。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="架構"></a>架構<a class="hash-link" href="#架構" title="Direct link to heading">#</a></h2><p><img src="https://raw.githubusercontent.com/r05323028/eyes/main/doc/static/images/architecture.png" alt="Architecture"></p><p>訓練 NLP 模型、預測等任務，主要是利用 <a href="https://spacy.io" target="_blank" rel="noopener noreferrer">spaCy</a> 來完成。會利用這個框架主要的原因是因為他擁有很完整的生態系，豐富的 pretrained models 、完整的文件、簡單明瞭的 ML lifecycle ，在效能上也不輸給其他主流的框架。</p><p><img src="https://raw.githubusercontent.com/r05323028/eyes/main/doc/static/images/flower_monitor.png" alt="Flower"></p><p>ETL pipeline 的部分，會使用 <a href="https://github.com/argoproj/argo-workflows/" target="_blank" rel="noopener noreferrer">Argo Workflows</a> + <a href="https://github.com/celery/celery" target="_blank" rel="noopener noreferrer">celery</a> ，利用 Producer-Consumer 的架構，由 Argo Workflows 定期調配任務，並經由 celery worker 來執行。在 Kubernetes 上，可以輕鬆地針對 celery worker 做 auto scaling ，可以更有效率的利用計算資源。</p><p><img src="https://raw.githubusercontent.com/r05323028/eyes/main/doc/static/images/entities_dashboard.png" alt="Web"></p><p>最後資料視覺化的部分使用 <a href="https://zh-hant.reactjs.org/" target="_blank" rel="noopener noreferrer">React</a> + <a href="https://fastapi.tiangolo.com/" target="_blank" rel="noopener noreferrer">FastAPI</a> 來建置網頁與 API 。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="spacy"></a>SpaCy<a class="hash-link" href="#spacy" title="Direct link to heading">#</a></h2><p>SpaCy 在 v3 以後，提供了利用 config 檔輕鬆定義訓練流程的方法。一般來說 NLP 的 pipeline 會有這幾個流程</p><div class="mermaid">graph LR; A(Tokenize) --&gt; B(Embedding); B --&gt; C(POS Tagging); C --&gt; D(Dependency Parsing); D --&gt; E(NER); E --&gt; F(Text Classification)</div><p>不同的 component 如果要自己管理的話非常的麻煩，而 spaCy 利用了以下的語法(以 Eyes 內用到的模型為例)，讓你輕鬆的管理每個 component</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly conf"><pre tabindex="0" class="prism-code language-conf codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">[paths]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">train = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain">dev = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain">vectors = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain">init_tok2vec = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[system]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">gpu_allocator = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain">seed = 0</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[nlp]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">lang = &quot;zh&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">pipeline = [&quot;tok2vec&quot;,&quot;tagger&quot;,&quot;parser&quot;,&quot;ner&quot;]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">batch_size = 32</span></span><span class="token-line" style="color:#393A34"><span class="token plain">disabled = []</span></span><span class="token-line" style="color:#393A34"><span class="token plain">before_creation = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain">after_creation = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain">after_pipeline_creation = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[nlp.tokenizer]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@tokenizers = &quot;spacy.zh.ChineseTokenizer&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">segmenter = &quot;char&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[components]</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[components.ner]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">factory = &quot;ner&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">incorrect_spans_key = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain">moves = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain">update_with_oracle_cut_size = 100</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[components.ner.model]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@architectures = &quot;spacy.TransitionBasedParser.v2&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">state_type = &quot;ner&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">extra_state_tokens = false</span></span><span class="token-line" style="color:#393A34"><span class="token plain">hidden_width = 64</span></span><span class="token-line" style="color:#393A34"><span class="token plain">maxout_pieces = 2</span></span><span class="token-line" style="color:#393A34"><span class="token plain">use_upper = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">nO = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[components.ner.model.tok2vec]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@architectures = &quot;spacy.Tok2Vec.v2&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[components.ner.model.tok2vec.embed]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@architectures = &quot;spacy.MultiHashEmbed.v2&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">width = 96</span></span><span class="token-line" style="color:#393A34"><span class="token plain">attrs = [&quot;ORTH&quot;,&quot;SHAPE&quot;]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">rows = [5000,2500]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">include_static_vectors = false</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[components.ner.model.tok2vec.encode]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@architectures = &quot;spacy.MaxoutWindowEncoder.v2&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">width = 96</span></span><span class="token-line" style="color:#393A34"><span class="token plain">depth = 4</span></span><span class="token-line" style="color:#393A34"><span class="token plain">window_size = 1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">maxout_pieces = 3</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[components.parser]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">source = &quot;zh_core_web_md&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[components.tagger]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">source = &quot;zh_core_web_md&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[components.tok2vec]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">source = &quot;zh_core_web_md&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[corpora]</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[corpora.dev]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@readers = &quot;spacy.Corpus.v1&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">path = ${paths.dev}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">max_length = 0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">gold_preproc = false</span></span><span class="token-line" style="color:#393A34"><span class="token plain">limit = 0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">augmenter = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[corpora.train]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@readers = &quot;spacy.Corpus.v1&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">path = ${paths.train}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">max_length = 0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">gold_preproc = false</span></span><span class="token-line" style="color:#393A34"><span class="token plain">limit = 0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">augmenter = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[training]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">dev_corpus = &quot;corpora.dev&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">train_corpus = &quot;corpora.train&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">seed = ${system.seed}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">gpu_allocator = ${system.gpu_allocator}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">dropout = 0.1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">accumulate_gradient = 1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">patience = 1600</span></span><span class="token-line" style="color:#393A34"><span class="token plain">max_epochs = 0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">max_steps = 20000</span></span><span class="token-line" style="color:#393A34"><span class="token plain">eval_frequency = 200</span></span><span class="token-line" style="color:#393A34"><span class="token plain">frozen_components = [&quot;tagger&quot;,&quot;parser&quot;,&quot;tok2vec&quot;]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">annotating_components = []</span></span><span class="token-line" style="color:#393A34"><span class="token plain">before_to_disk = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[training.batcher]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@batchers = &quot;spacy.batch_by_words.v1&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">discard_oversize = false</span></span><span class="token-line" style="color:#393A34"><span class="token plain">tolerance = 0.2</span></span><span class="token-line" style="color:#393A34"><span class="token plain">get_length = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[training.batcher.size]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@schedules = &quot;compounding.v1&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">start = 100</span></span><span class="token-line" style="color:#393A34"><span class="token plain">stop = 1000</span></span><span class="token-line" style="color:#393A34"><span class="token plain">compound = 1.001</span></span><span class="token-line" style="color:#393A34"><span class="token plain">t = 0.0</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[training.logger]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@loggers = &quot;spacy.ConsoleLogger.v1&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">progress_bar = false</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[training.optimizer]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">@optimizers = &quot;Adam.v1&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">beta1 = 0.9</span></span><span class="token-line" style="color:#393A34"><span class="token plain">beta2 = 0.999</span></span><span class="token-line" style="color:#393A34"><span class="token plain">L2_is_weight_decay = true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">L2 = 0.01</span></span><span class="token-line" style="color:#393A34"><span class="token plain">grad_clip = 1.0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">use_averages = false</span></span><span class="token-line" style="color:#393A34"><span class="token plain">eps = 0.00000001</span></span><span class="token-line" style="color:#393A34"><span class="token plain">learn_rate = 0.001</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[training.score_weights]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">tag_acc = 0.33</span></span><span class="token-line" style="color:#393A34"><span class="token plain">dep_uas = 0.17</span></span><span class="token-line" style="color:#393A34"><span class="token plain">dep_las = 0.17</span></span><span class="token-line" style="color:#393A34"><span class="token plain">dep_las_per_type = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain">sents_p = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain">sents_r = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain">sents_f = 0.0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ents_f = 0.33</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ents_p = 0.0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ents_r = 0.0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ents_per_type = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[pretraining]</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[initialize]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">vectors = ${paths.vectors}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">init_tok2vec = ${paths.init_tok2vec}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">vocab_data = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain">lookups = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain">before_init = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain">after_init = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[initialize.components]</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">[initialize.tokenizer]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">pkuseg_model = null</span></span><span class="token-line" style="color:#393A34"><span class="token plain">pkuseg_user_dict = &quot;default&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>可以輕鬆的定義，要使用哪個 pretrained model 、哪些 components 是要從原先的模型繼承、哪些 components 的參數要凍結、優化器的參數等等。在 Eyes 的模型中我們只訓練 NER 的模型，所以我們繼承了原先模型的 Embeddings 、 POS Tagging 、 Dependency Parsing ，並將其凍結。</p><p>然後可以使用簡單的指令來訓練模型</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">spacy train config/spacy/zh_core_eyes_md.cfg --paths.train </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">TRAIN_FILE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> --paths.dev </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">DEV_FILE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> --output </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">OUTPUT_DIR</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> --initialize.vectors zh_core_web_md</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>更多的介紹可以參照 <a href="https://spacy.io/usage/training" target="_blank" rel="noopener noreferrer">https://spacy.io/usage/training</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="argo-workflows"></a>Argo Workflows<a class="hash-link" href="#argo-workflows" title="Direct link to heading">#</a></h2><p>Argo workflows 擁有簡單便利的圖形化介面，方便查看每個 Cronjob 執行的狀況、管理任務的調用等等。當初會選用這個的原因，是因為原本就打算將整個系統利用 Kubernetes 來部署，而 Argo workflows 又跟 Kubernetes 很好的整合在一起了。在語法方面，幾乎是只要會寫 Kubernetes 的 API ，稍微看一下文件馬上就能上手，以 PTT 的 Daily pipeline 為例:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> argoproj.io/v1alpha1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> CronWorkflow</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ptt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">posts</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">schedule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0 8 * * *&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">timezone</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Asia/Taipei&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">workflowSpec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">entrypoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">templates</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pipeline</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">dag</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> crawl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">top</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">board</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">posts</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> crawl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">top</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">board</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">posts</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">arguments</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> n_days</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ .Values.n_days }}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> transform</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ptt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">posts</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> transform</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ptt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">posts</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">spacy</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">depends</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;crawl-top-board-posts&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">arguments</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> year</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ `{{ workflow.creationTimestamp.Y }}` }}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> month</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ `{{ workflow.creationTimestamp.m }}` }}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ptt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">monthly</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">summary</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">depends</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;transform-ptt-posts&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stats</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ptt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">summaries</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">arguments</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> year</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ `{{ workflow.creationTimestamp.Y }}` }}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> month</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ `{{ workflow.creationTimestamp.m }}` }}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> entity</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">monthly</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">summary</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">depends</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;transform-ptt-posts&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stats</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">entity</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">summaries</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">arguments</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> year</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ `{{ workflow.creationTimestamp.Y }}` }}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> month</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ `{{ workflow.creationTimestamp.m }}` }}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> crawl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">top</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">board</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">posts</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">inputs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> n_days</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">container</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eyes/base</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Never</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;/bin/bash&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;--&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">envFrom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">configMapRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eyes</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prod</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string" style="color:#e3116c">&quot;poetry run eyes job dispatch --job_type CRAWL_PTT_TOP_BOARD_POSTS --n_days {{ `{{ inputs.parameters.n_days }}` }}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> transform</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ptt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">posts</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">spacy</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">inputs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> year</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> month</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">container</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eyes/base</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Never</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;/bin/bash&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;--&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">envFrom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">configMapRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eyes</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prod</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string" style="color:#e3116c">&quot;poetry run eyes job dispatch --job_type PTT_SPACY_PIPELINE --year {{ `{{ inputs.parameters.year }}` }} --month {{ `{{ inputs.parameters.month }}` }}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stats</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ptt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">summaries</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">inputs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> year</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> month</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">container</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eyes/base</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Never</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;/bin/bash&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;--&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">envFrom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">configMapRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eyes</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prod</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string" style="color:#e3116c">&quot;poetry run eyes job dispatch --job_type PTT_MONTHLY_SUMMARY --year {{ `{{ inputs.parameters.year }}` }} --month {{ `{{ inputs.parameters.month }}` }}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> stats</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">entity</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">summaries</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">inputs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> year</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> month</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">container</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eyes/base</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Never</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;/bin/bash&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;--&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">envFrom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">configMapRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eyes</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prod</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string" style="color:#e3116c">&quot;poetry run eyes job dispatch --job_type ENTITY_MONTHLY_SUMMARY --year {{ `{{ inputs.parameters.year }}` }} --month {{ `{{ inputs.parameters.month }}` }}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>他可以很輕鬆的利用 Docker image 來跑起 Container ，並把每個步驟組成 DAG ，部署 Pipeline 的方式也跟 Kubernetes 的其他元件一樣，非常便利。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="weak-supervision"></a>Weak Supervision<a class="hash-link" href="#weak-supervision" title="Direct link to heading">#</a></h2><p><a href="https://en.wikipedia.org/wiki/Weak_supervision" target="_blank" rel="noopener noreferrer">Weak supervision</a> 是我們拿來減少人工標記成本的一種手段，透過類似 Rule-based 的方法來定義 Labeling Functions ，並利用這些函數來進行標記，最後產出的 Label 會透過一個 Aggregation model 來決定，細節的部分可以參考 <a href="https://github.com/NorskRegnesentral/skweak" target="_blank" rel="noopener noreferrer">skweak</a> ，因為在 Eyes 裡面，我們透過爬蟲爬回來的 Entity 就有上萬個，不大可能利用人工標記的方法來產生訓練資料，所以採用了弱監督的方法。</p><div class="mermaid">graph LR; A(LF1) --&gt; B(Aggregate); C(LF2) --&gt; B; B --&gt; D(Final Label); E(LF3) --&gt; B;</div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="結語"></a>結語<a class="hash-link" href="#結語" title="Direct link to heading">#</a></h2><p>第一次認真地開發 Side project ，發現自己走過一遍以後對於系統架構、各種常用的框架有了更深入的了解。但疲累程度也是工作時的數倍 XD</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/blog/tags/datascience">datascience</a><a class="margin-horiz--sm" href="/blog/tags/nlp">nlp</a><a class="margin-horiz--sm" href="/blog/tags/public-opinion">public opinion</a></div><div class="col text--right"><a aria-label="Read more about Eyes - 台灣輿情監測系統" href="/blog/eyes"><b>Read More</b></a></div></footer></article></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">社群</div><ul class="footer__items"><li class="footer__item"><a href="https://www.facebook.com/sean50301/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook</a></li><li class="footer__item"><a href="https://www.linkedin.com/in/r05323028/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">部落格</a></li><li class="footer__item"><a href="https://github.com/r05323028" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Sean Chang, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0a5721f4.js"></script>
<script src="/assets/js/main.a028968b.js"></script>
</body>
</html>